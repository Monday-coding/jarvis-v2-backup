# RAG ç·©å­˜ç³»çµ±æ–‡æª”

## ğŸ“š æ¦‚è¿°

RAGï¼ˆRetrieval-Augmented Generationï¼Œæª¢ç´¢å¢å¼·ç”Ÿæˆï¼‰ç·©å­˜ç³»çµ±æ˜¯ä¸€å€‹æ™ºèƒ½çš„çŸ¥è­˜æª¢ç´¢å’Œç·©å­˜æ©Ÿåˆ¶ï¼Œå¯ä»¥å¤§å¹…æå‡å¸¸è¦‹å•é¡Œçš„éŸ¿æ‡‰é€Ÿåº¦ã€‚

### æ ¸å¿ƒåŠŸèƒ½

1. **çŸ¥è­˜åº«ç´¢å¼•**ï¼šå¾ `knowledge-base.md` æ§‹å»ºå¯æœç´¢çš„ç´¢å¼•
2. **å¿«é€Ÿæª¢ç´¢**ï¼šä½¿ç”¨é—œéµè©åŒ¹é… + æ¨™ç±¤åŒ¹é…é€²è¡Œæ™ºèƒ½æœç´¢
3. **æ™ºèƒ½ç·©å­˜**ï¼šç·©å­˜å¸¸è¦‹å•ç­”ï¼Œå¯¦ç¾ < 0.1s éŸ¿æ‡‰
4. **è‡ªå‹•æ›´æ–°**ï¼šæ”¯æŒ cron å®šæœŸæ›´æ–°ç´¢å¼•

---

## ğŸ—ï¸ ç³»çµ±æ¶æ§‹

```
User Question
    â†“
1. æª¢æŸ¥ RAG ç·©å­˜
    â”œâ”€ å‘½ä¸­ï¼Ÿâ†’ ç›´æ¥è¿”å›ç­”æ¡ˆï¼ˆ<0.1sï¼‰âœ…
    â””â”€ æœªå‘½ä¸­ï¼Ÿâ†’ ç¹¼çºŒ
        â†“
2. æœç´¢çŸ¥è­˜åº«
    â”œâ”€ é—œéµè©åŒ¹é…
    â”œâ”€ æ¨™ç±¤åŒ¹é…
    â””â”€ æ‘˜è¦åŒ¹é…
        â†“
3. è¿”å›æœç´¢çµæœ
    â†“
4. ï¼ˆå¯é¸ï¼‰å­˜å„²åˆ°ç·©å­˜
```

---

## ğŸ“ æ–‡ä»¶çµæ§‹

```
~/.openclaw/workspace/
â”œâ”€â”€ rag_cache.py          # RAG ç·©å­˜ä¸»è…³æœ¬
â”œâ”€â”€ rag_update.sh         # Cron æ›´æ–°è…³æœ¬
â”œâ”€â”€ knowledge-base.md     # çŸ¥è­˜åº«æºæ–‡ä»¶
â””â”€â”€ rag/
    â”œâ”€â”€ cache.json        # å•ç­”ç·©å­˜
    â”œâ”€â”€ index.json        # çŸ¥è­˜åº«ç´¢å¼•
    â””â”€â”€ log.txt          # é‹è¡Œæ—¥èªŒ
```

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. æ§‹å»ºç´¢å¼•

```bash
cd ~/.openclaw/workspace
python3 rag_cache.py
```

### 2. æ‰‹å‹•æ›´æ–°ç´¢å¼•

```bash
./rag_update.sh
```

### 3. è¨­ç½® Cron Jobï¼ˆè‡ªå‹•æ›´æ–°ï¼‰

```bash
# æ¯å°æ™‚æ›´æ–°ä¸€æ¬¡
(crontab -l 2>/dev/null; echo "0 * * * * /home/jarvis/.openclaw/workspace/rag_update.sh >> /home/jarvis/.openclaw/workspace/rag/update.log 2>&1") | crontab -
```

### 4. æŸ¥çœ‹ RAG çµ±è¨ˆ

```bash
python3 -c "
import sys
sys.path.insert(0, '/home/jarvis/.openclaw/workspace')
from rag_cache import RAGCache

rag = RAGCache()
stats = rag.get_cache_stats()

print('RAG çµ±è¨ˆ:')
for key, value in stats.items():
    print(f'  {key}: {value}')
"
```

---

## ğŸ” æœç´¢ç®—æ³•

### ç›¸ä¼¼åº¦è¨ˆç®—

ä½¿ç”¨åŠ æ¬Šé—œéµè©åŒ¹é…ï¼š

| åŒ¹é…é¡å‹ | æ¬Šé‡ | èªªæ˜ |
|---------|------|------|
| æ¨™é¡Œç²¾ç¢ºåŒ¹é… | 15 | å®Œå…¨åŒ¹é…æ¨™é¡Œ |
| æ¨™é¡ŒåŒ…å«åŒ¹é… | 10 | æ¨™é¡ŒåŒ…å«æŸ¥è©¢è© |
| å…§å®¹åŒ¹é… | 5 | å…§å®¹åŒ…å«æŸ¥è©¢è© |
| æ¨™ç±¤åŒ¹é… | 3 | æ¨™ç±¤åŒ…å«æŸ¥è©¢è© |
| æ‘˜è¦åŒ¹é… | 2 | æ‘˜è¦åŒ…å«æŸ¥è©¢è© |

### ç¤ºä¾‹

```
æŸ¥è©¢: "Python è…³æœ¬å„ªåŒ–"

çŸ¥è­˜åº«æ¢ç›®:
- æ¨™é¡Œ: "Python è…³æœ¬å„ªåŒ–" â†’ 15 åˆ†ï¼ˆç²¾ç¢ºåŒ¹é…ï¼‰
- å…§å®¹: "...å„ªåŒ–äº† Python è…³æœ¬..." â†’ 5 åˆ†
- æ¨™ç±¤: ["python", "å„ªåŒ–", "æ•ˆç‡"] â†’ 3 + 3 = 6 åˆ†

ç¸½åˆ†: 26 åˆ†
```

---

## ğŸ“Š çŸ¥è­˜åº«æ ¼å¼

### knowledge-base.md çµæ§‹

```markdown
## 2026-02-25

### CODE

#### Python è…³æœ¬å„ªåŒ–
**æ‘˜è¦ï¼š** å„ªåŒ–äº† Python è…³æœ¬çš„åŸ·è¡Œé€Ÿåº¦
**æ¨™ç±¤ï¼š** python, å„ªåŒ–, æ•ˆç‡

é€™è£¡æ˜¯è©³ç´°å…§å®¹...

#### Git Hook è¨­ç½®
**æ‘˜è¦ï¼š** é…ç½®äº† pre-commit hook
**æ¨™ç±¤ï¼š** git, ç‰ˆæœ¬æ§åˆ¶, è‡ªå‹•åŒ–

### TASK

#### ç³»çµ±è¨­ç½®
**æ‘˜è¦ï¼š** å®Œæˆäº† Ollama + Multi-Agent è¨­ç½®
**æ¨™ç±¤ï¼š** ç³»çµ±, è¨­ç½®, ollama, multi-agent

### RESEARCH

#### ç¥ç¶“å…ƒå„ªåŒ–ç ”ç©¶
**æ‘˜è¦ï¼š** ç ”ç©¶äº† NeurOpt æ¶æ§‹
**æ¨™ç±¤ï¼š** ç ”ç©¶, ç¥ç¶“å…ƒå„ªåŒ–, AI
```

---

## ğŸ¯ é›†æˆåˆ° OpenClaw

### åœ¨ Agent ä¸­ä½¿ç”¨ RAG

å‰µå»º `~/.openclaw/agents/chat/agent/RAG.md`ï¼š

```markdown
# RAG æª¢ç´¢

ä½ æœ‰ RAG ç·©å­˜èƒ½åŠ›ï¼Œå¯ä»¥å¿«é€Ÿæª¢ç´¢çŸ¥è­˜ã€‚

### ä½¿ç”¨æ–¹æ³•

ç•¶ç”¨æˆ¶å•åˆ°ç›¸é—œçŸ¥è­˜æ™‚ï¼š

1. å…ˆæª¢æŸ¥ RAG ç·©å­˜
2. å¦‚æœæœ‰ç·©å­˜ç­”æ¡ˆï¼Œç›´æ¥ä½¿ç”¨
3. å¦‚æœæ²’æœ‰ï¼Œæœç´¢çŸ¥è­˜åº«
4. æ ¹æ“šæœç´¢çµæœå›ç­”
5. å°‡å¸¸è¦‹å•é¡Œå­˜å…¥ç·©å­˜

### Python ç¤ºä¾‹

```python
from pathlib import Path
import sys
sys.path.insert(0, str(Path.home() / ".openclaw" / "workspace"))

from rag_cache import RAGCache

rag = RAGCache()

# æŸ¥è©¢
cached_answer, search_results = rag.query("Python è…³æœ¬å„ªåŒ–")

if cached_answer:
    return cached_answer

if search_results:
    # ä½¿ç”¨æœç´¢çµæœå›ç­”
    return f"æ ¹æ“šçŸ¥è­˜åº«ï¼Œ{search_results[0]['summary']}..."
```
```

---

## ğŸ“ˆ æ€§èƒ½é æœŸ

### éŸ¿æ‡‰æ™‚é–“å°æ¯”

| æ“ä½œ | ç„¡ RAG | æœ‰ RAG | æå‡ |
|------|---------|--------|------|
| å¸¸è¦‹å•é¡Œï¼ˆç·©å­˜å‘½ä¸­ï¼‰ | 5-8s | **<0.1s** | **50-80å€ â†‘** |
| çŸ¥è­˜åº«æœç´¢ | - | **<0.5s** | - |
| ç”Ÿæˆç­”æ¡ˆ | 5-8s | 5-8s | - |

### ç¯€çœçš„ API èª¿ç”¨

å‡è¨­æ¯å¤© 100 æ¬¡æŸ¥è©¢ï¼Œå…¶ä¸­ 30 æ¬¡æ˜¯å¸¸è¦‹å•é¡Œï¼š

| é …ç›® | ç„¡ RAG | æœ‰ RAG | ç¯€çœ |
|------|---------|--------|------|
| API èª¿ç”¨ | 100 æ¬¡ | 70 æ¬¡ | **30% â†“** |
| æ¯æ—¥æˆæœ¬ | ~$0.1 | ~$0.07 | **30% â†“** |
| æ¯æœˆæˆæœ¬ | ~$3 | ~$2.1 | **30% â†“** |

---

## ğŸ”§ é«˜ç´šé…ç½®

### èª¿æ•´æœç´¢åƒæ•¸

ç·¨è¼¯ `rag_cache.py`ï¼š

```python
# ä¿®æ”¹è¿”å›çµæœæ•¸é‡
results = rag.search(query, top_k=10)  # é»˜èª 5

# ä¿®æ”¹ç›¸ä¼¼åº¦é–¾å€¼
if score > 5:  # é»˜èª > 0
    results.append(...)
```

### ä½¿ç”¨çœŸå¯¦çš„å‘é‡åµŒå…¥

æ›¿æ› `_get_embedding` æ–¹æ³•ï¼š

```python
def _get_embedding(self, text: str, model: str = "nomic-embed-text") -> Optional[List[float]]:
    """ä½¿ç”¨ Ollama ç²å–çœŸå¯¦çš„æ–‡æœ¬åµŒå…¥"""
    payload = {
        "model": model,
        "prompt": text
    }

    result = subprocess.run(
        ['curl', '-s', '-X', 'POST', 'http://localhost:11434/api/embeddings',
         '-H', 'Content-Type: application/json',
         '-d', json.dumps(payload)],
        capture_output=True,
        text=True,
        timeout=30
    )

    try:
        response = json.loads(result.stdout)
        return response.get('embedding')
    except:
        return None
```

éœ€è¦å…ˆä¸‹è¼‰åµŒå…¥æ¨¡å‹ï¼š

```bash
curl http://localhost:11434/api/pull -d '{"name":"nomic-embed-text","stream":false}'
```

---

## ğŸ› æ•…éšœæ’é™¤

### å•é¡Œï¼šçŸ¥è­˜åº«æ²’æœ‰æ¢ç›®

**åŸå› **ï¼š`knowledge-base.md` æ ¼å¼ä¸æ­£ç¢º

**è§£æ±º**ï¼šæª¢æŸ¥æ ¼å¼ï¼Œç¢ºä¿ä½¿ç”¨ `##`, `###`, `####` å±¤ç´š

### å•é¡Œï¼šæœç´¢çµæœä¸æº–ç¢º

**åŸå› **ï¼šç›¸ä¼¼åº¦ç®—æ³•å¤ªç°¡å–®

**è§£æ±º**ï¼šä½¿ç”¨çœŸå¯¦çš„å‘é‡åµŒå…¥ï¼ˆè¦‹é«˜ç´šé…ç½®ï¼‰

### å•é¡Œï¼šç·©å­˜ä¸å·¥ä½œ

**åŸå› **ï¼šç·©å­˜æ–‡ä»¶æ¬Šé™å•é¡Œ

**è§£æ±º**ï¼š
```bash
chmod 644 ~/.openclaw/workspace/rag/cache.json
```

---

## ğŸ“ é–‹ç™¼è¨ˆåŠƒ

### å·²å®Œæˆ âœ…

- [x] åŸºç¤ RAG ç·©å­˜ç³»çµ±
- [x] çŸ¥è­˜åº«ç´¢å¼•
- [x] é—œéµè©æœç´¢
- [x] æ™ºèƒ½ç·©å­˜
- [x] Cron æ›´æ–°è…³æœ¬

### å¾…å®Œæˆ ğŸ“

- [ ] çœŸå¯¦çš„å‘é‡åµŒå…¥ï¼ˆOllama embeddingsï¼‰
- [ ] èªç¾©ç›¸ä¼¼åº¦è¨ˆç®—
- [ ] ä¸»å‹•å­¸ç¿’ï¼ˆæ ¹æ“šæŸ¥è©¢è‡ªå‹•æ·»åŠ åˆ°çŸ¥è­˜åº«ï¼‰
- [ ] å¤šèªè¨€æ”¯æŒ
- [ ] Web UI æŸ¥çœ‹å™¨

---

**æœ€å¾Œæ›´æ–°**ï¼š2026-02-25
**ä½œè€…**ï¼šJarvis ğŸ¤–
