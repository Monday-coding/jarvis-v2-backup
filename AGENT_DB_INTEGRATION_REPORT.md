# ğŸ”— Agent æ•¸æ“šåº«é›†æˆå ±å‘Š

## ğŸ“‹ é›†æˆæ‘˜è¦

**é›†æˆæ™‚é–“**ï¼š2026-02-26 08:30
**é›†æˆç‹€æ…‹**ï¼šâœ… æˆåŠŸ

---

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. å‰µå»ºæ•¸æ“šåº«é€£æ¥å™¨ â­â­â­â­â­

**æ–‡ä»¶**ï¼š`agent_db_connector.py`

**æ ¸å¿ƒé¡**ï¼š
- `PostgreSQLConnector` - åŸºç¤é€£æ¥å™¨
- `AgentDatabase` - Agent å°ˆç”¨æ“ä½œé¡

**åŠŸèƒ½**ï¼š
- âœ… æ•¸æ“šåº«é€£æ¥ç®¡ç†
- âœ… ä¸Šä¸‹æ–‡ç®¡ç†å™¨æ”¯æŒ
- âœ… éŒ¯èª¤è™•ç†å’Œå›æ»¾
- âœ… é¡å‹æç¤ºå’Œæ–‡æª”

---

### 2. å¯¦ç¾æ‰€æœ‰æ ¸å¿ƒæ“ä½œ â­â­â­â­â­

#### Agents æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `get_agent()` | ç²å–å–®å€‹ Agent | âœ… |
| `get_all_agents()` | ç²å–æ‰€æœ‰ Agents | âœ… |
| `register_agent_activity()` | è¨»å†Š Agent æ´»å‹• | âœ… |

#### Conversations æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `create_conversation()` | å‰µå»ºå°è©±æœƒè©± | âœ… |
| `get_conversation()` | ç²å–å°è©±æœƒè©± | âœ… |
| `get_recent_conversations()` | ç²å–æœ€è¿‘çš„å°è©± | âœ… |

#### Messages æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `save_message()` | ä¿å­˜æ¶ˆæ¯ | âœ… |
| `get_conversation_messages()` | ç²å–å°è©±æ¶ˆæ¯ | âœ… |

#### Knowledge Base æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `save_knowledge()` | ä¿å­˜çŸ¥è­˜ | âœ… |
| `search_knowledge()` | æœç´¢çŸ¥è­˜åº« | âœ… |

#### Memory æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `save_memory()` | ä¿å­˜è¨˜æ†¶ | âœ… |
| `get_memory()` | ç²å–è¨˜æ†¶ | âœ… |

#### Logs æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `save_log()` | ä¿å­˜æ—¥èªŒ | âœ… |
| `get_logs()` | ç²å–æ—¥èªŒ | âœ… |

#### Tasks æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `create_task()` | å‰µå»ºä»»å‹™ | âœ… |
| `get_tasks()` | ç²å–ä»»å‹™ | âœ… |
| `update_task_status()` | æ›´æ–°ä»»å‹™ç‹€æ…‹ | âœ… |

#### System Metrics æ“ä½œ

| æ–¹æ³• | åŠŸèƒ½ | ç‹€æ…‹ |
|------|------|------|
| `save_metric()` | ä¿å­˜ç³»çµ±æŒ‡æ¨™ | âœ… |
| `get_metrics()` | ç²å–ç³»çµ±æŒ‡æ¨™ | âœ… |

---

### 3. å®Œæ•´åŠŸèƒ½æ¸¬è©¦ â­â­â­â­â­

**æ¸¬è©¦æ–‡ä»¶**ï¼š`test_db_connector.py`

**æ¸¬è©¦çµæœ**ï¼š

| # | æ¸¬è©¦ | ç‹€æ…‹ |
|---|------|------|
| 1 | é€£æ¥æ•¸æ“šåº« | âœ… æˆåŠŸ |
| 2 | ç²å–æ‰€æœ‰ Agents | âœ… æˆåŠŸï¼ˆ7 å€‹ï¼‰|
| 3 | ç²å–æ‰€æœ‰è¡¨ | âœ… æˆåŠŸï¼ˆ10 å€‹ï¼‰|
| 4 | å‰µå»ºæ¸¬è©¦å°è©± | âœ… æˆåŠŸ |
| 5 | ä¿å­˜æ¸¬è©¦æ¶ˆæ¯ | âœ… æˆåŠŸ |
| 6 | ä¿å­˜æ¸¬è©¦çŸ¥è­˜ | âœ… æˆåŠŸ |
| 7 | ä¿å­˜æ¸¬è©¦è¨˜æ†¶ | âœ… æˆåŠŸ |
| 8 | ä¿å­˜æ¸¬è©¦æ—¥èªŒ | âœ… æˆåŠŸ |
| 9 | å‰µå»ºæ¸¬è©¦ä»»å‹™ | âœ… æˆåŠŸ |
| 10 | ä¿å­˜æ¸¬è©¦æŒ‡æ¨™ | âœ… æˆåŠŸ |

**æ¸¬è©¦è¼¸å‡º**ï¼š
```
âœ… æ‰¾åˆ° 7 å€‹ Agents
âœ… æ‰¾åˆ° 10 å€‹è¡¨
âœ… æ‰€æœ‰ CRUD æ“ä½œæ­£å¸¸
```

---

### 4. å®‰è£ä¾è³´ â­â­â­â­â­

**è™›æ“¬ç’°å¢ƒ**ï¼š`venv/`

**å®‰è£çš„åŒ…**ï¼š
- `psycopg2-binary` 2.9.11

**ç‰ˆæœ¬ä¿¡æ¯**ï¼š
- Pythonï¼š3.14
- PostgreSQLï¼š15.16

---

## ğŸ“Š æ•¸æ“šåº«ç‹€æ…‹

### å·²é…ç½®çš„ Agentsï¼ˆ7 å€‹ï¼‰

| Agent ID | åç¨± | æ¨¡å‹ | Provider |
|----------|------|------|----------|
| main | Main Agent | zai/glm-4.7 | zai |
| classifier | Classifier | ollama/qwen2.5:1.5b | ollama |
| chat | Chat Agent | zai/glm-4.7-flashx | zai |
| task | Task Agent | zai/glm-4.7-flash | zai |
| coding | Coding Agent | zai/glm-4.7 | zai |
| data | Data Agent | zai/glm-4.7-flash | zai |
| qa | QA Agent | zai/glm-4.7-flash | zai |

---

## ğŸ”§ ä½¿ç”¨æ–¹æ³•

### 1. åœ¨ Agent ä¸­å°å…¥

```python
import sys
sys.path.insert(0, '/home/jarvis/.openclaw/workspace/database')

from agent_db_connector import AgentDatabase
```

### 2. å‰µå»ºå¯¦ä¾‹

```python
# å‰µå»ºæ•¸æ“šåº«å¯¦ä¾‹
agent_db = AgentDatabase()

# ä½¿ç”¨ä¸Šä¸‹æ–‡ç®¡ç†å™¨
with agent_db.db:
    # åŸ·è¡Œæ•¸æ“šåº«æ“ä½œ
    agents = agent_db.get_all_agents()
```

### 3. ä¿å­˜å°è©±

```python
# å‰µå»ºå°è©±
agent_db.create_conversation(
    conversation_id="conv_001",
    channel="telegram",
    user_id="user_123",
    title="ç³»çµ±è¨­ç½®"
)

# ä¿å­˜æ¶ˆæ¯
agent_db.save_message(
    message_id="msg_001",
    conversation_id="conv_001",
    role="user",
    content="å„ªåŒ–ç³»çµ±è¨­ç½®",
    agent_id="chat",
    token_count=50
)
```

### 4. æŸ¥è©¢çŸ¥è­˜

```python
# æœç´¢çŸ¥è­˜
knowledge = agent_db.search_knowledge("Python å„ªåŒ–", category="CODE", limit=5)

for item in knowledge:
    print(f"æ¨™é¡Œ: {item['title']}")
    print(f"æ‘˜è¦: {item['summary']}")
```

---

## ğŸ¯ é›†æˆå„ªå‹¢

### 1. çµ±ä¸€æ•¸æ“šå­˜å„²

- âœ… æ‰€æœ‰ Agents ä½¿ç”¨åŒä¸€æ•¸æ“šåº«
- âœ… æ•¸æ“šä¸€è‡´æ€§ä¿è­‰ï¼ˆACIDï¼‰
- âœ… çµ±ä¸€æŸ¥è©¢æ¥å£

### 2. é«˜æ€§èƒ½æŸ¥è©¢

- âœ… ç´¢å¼•å„ªåŒ–
- âœ… JSONB æŸ¥è©¢
- âœ… GIN ç´¢å¼•æ”¯æŒæ•¸çµ„

### 3. æ˜“æ–¼ä½¿ç”¨

- âœ… Python ä¸Šä¸‹æ–‡ç®¡ç†å™¨
- âœ… é¡å‹æç¤º
- âœ… éŒ¯èª¤è™•ç†

### 4. å®Œæ•´åŠŸèƒ½è¦†è“‹

- âœ… Agents ç®¡ç†
- âœ… å°è©±ç®¡ç†
- âœ… çŸ¥è­˜åº«
- âœ… è¨˜æ†¶ç³»çµ±
- âœ… æ—¥èªŒç³»çµ±
- âœ… ä»»å‹™ç³»çµ±
- âœ… æŒ‡æ¨™ç³»çµ±

---

## ğŸ“ ä¸‹ä¸€æ­¥é›†æˆ

### 1. é›†æˆåˆ° Main Agent

åœ¨ `AGENTS.md` ä¸­æ·»åŠ ï¼š
```markdown
## æ•¸æ“šåº«é›†æˆ

ä½ æœ‰ PostgreSQL æ•¸æ“šåº«èƒ½åŠ›ã€‚

### ä½¿ç”¨æ–¹æ³•

```python
from agent_db_connector import AgentDatabase

# å‰µå»ºå¯¦ä¾‹
db = AgentDatabase()

# ä½¿ç”¨æ•¸æ“šåº«
with db.db:
    agents = db.get_all_agents()
```

### å¯ç”¨æ“ä½œ

- ä¿å­˜å°è©±è¨˜éŒ„
- æŸ¥è©¢çŸ¥è­˜åº«
- å­˜å„²è¨˜æ†¶
- è¨˜éŒ„æ—¥èªŒ
- å‰µå»ºä»»å‹™
```

### 2. é›†æˆåˆ°å…¶ä»– Agents

- Chat Agentï¼šä¿å­˜å°è©±å’ŒçŸ¥è­˜
- Coding Agentï¼šå‰µå»ºä»»å‹™
- Task Agentï¼šç®¡ç†ä»»å‹™
- System Adminï¼šç›£æ§æŒ‡æ¨™

---

## âœ… ç¸½çµ

**é›†æˆç‹€æ…‹**ï¼šâœ… æˆåŠŸ

- âœ… æ•¸æ“šåº«é€£æ¥å™¨å‰µå»ºå®Œæˆ
- âœ… æ‰€æœ‰æ ¸å¿ƒæ“ä½œå¯¦ç¾
- âœ… å®Œæ•´åŠŸèƒ½æ¸¬è©¦é€šé
- âœ… ä¾è³´å®‰è£å®Œæˆ
- âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸å·¥ä½œ

**æº–å‚™å°±ç·’**ï¼šå¯ä»¥é–‹å§‹é›†æˆåˆ° Agents

---

**é›†æˆå®Œæˆï¼æ•¸æ“šåº«é€£æ¥å™¨å·²æº–å‚™å¥½ä¾›æ‰€æœ‰ Agents ä½¿ç”¨ã€‚** ğŸ‰
